# --- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö ---

# –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä C
CC = gcc
# –§–ª–∞–≥–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–∞:
# -Wall: –í–∫–ª—é—á–∏—Ç—å –≤—Å–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
# -Wextra: –í–∫–ª—é—á–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
# -g: –í–∫–ª—é—á–∏—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
# -I<–∫–∞—Ç–∞–ª–æ–≥>: –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–∞–ª–æ–≥ –≤ —Å–ø–∏—Å–æ–∫ –ø–æ–∏—Å–∫–∞ –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
CFLAGS = -Wall -Wextra -g -Iinclude

# –§–ª–∞–≥–∏ –ª–∏–Ω–∫–µ—Ä–∞
LDFLAGS = 

# –ò–º—è –∫–æ–Ω–µ—á–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞
TARGET = telemetry_app

# –ö–∞—Ç–∞–ª–æ–≥–∏
SRC_DIR = src
INC_DIR = include
BUILD_DIR = build

# –í—Å–µ –∏—Å—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã (.c)
# $(wildcard <—à–∞–±–ª–æ–Ω>) –Ω–∞—Ö–æ–¥–∏—Ç —Ñ–∞–π–ª—ã, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —à–∞–±–ª–æ–Ω—É
SRCS = $(wildcard $(SRC_DIR)/coordinates_decoder/*.c) \
       $(wildcard $(SRC_DIR)/telemetry_analyzer/*.c) \
       $(SRC_DIR)/main.c

# –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –æ–±—ä–µ–∫—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã (.o) –≤ –∫–∞—Ç–∞–ª–æ–≥–µ —Å–±–æ—Ä–∫–∏
# $(patsubst <—à–∞–±–ª–æ–Ω>, <–∑–∞–º–µ–Ω–∞>, <—Ç–µ–∫—Å—Ç>): –∑–∞–º–µ–Ω—è–µ—Ç —á–∞—Å—Ç–∏ —Å—Ç—Ä–æ–∫
OBJS = $(patsubst $(SRC_DIR)/%.c, $(BUILD_DIR)/%.o, $(SRCS))


# --- –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–µ–ª–∏ ---

# –¶–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: —Å–æ–∑–¥–∞–µ—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª
all: $(BUILD_DIR) $(TARGET)

# –°–±–æ—Ä–∫–∞ –∫–æ–Ω–µ—á–Ω–æ–≥–æ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞
$(TARGET): $(OBJS)
	@echo "üîó –õ–∏–Ω–∫–æ–≤–∫–∞ $@"
	$(CC) $(OBJS) -o $@ $(LDFLAGS)

# –¶–µ–ª—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞ —Å–±–æ—Ä–∫–∏, –µ—Å–ª–∏ –æ–Ω –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
$(BUILD_DIR):
	@echo "üìÅ –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ —Å–±–æ—Ä–∫–∏: $(BUILD_DIR)"
	@mkdir -p $(BUILD_DIR)

# –û–±—â–µ–µ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏:
# –°–æ–∑–¥–∞–µ—Ç –æ–±—ä–µ–∫—Ç–Ω—ã–π —Ñ–∞–π–ª –≤ BUILD_DIR –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –≤ SRC_DIR
# $<: –∏–º—è –ø–µ—Ä–≤–æ–≥–æ —É—Å–ª–æ–≤–∏—è (–∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª .c)
# $@: –∏–º—è —Ü–µ–ª–∏ (–æ–±—ä–µ–∫—Ç–Ω—ã–π —Ñ–∞–π–ª .o)
$(BUILD_DIR)/%.o: $(SRC_DIR)/%.c
	@echo "üî® –ö–æ–º–ø–∏–ª—è—Ü–∏—è $<"
	$(CC) $(CFLAGS) -c $< -o $@

# --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ü–µ–ª–∏ ---

# –û—á–∏—Å—Ç–∫–∞: —É–¥–∞–ª—è–µ—Ç –≤—Å–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
clean:
	@echo "üßπ –û—á–∏—Å—Ç–∫–∞..."
	$(RM) -r $(BUILD_DIR) $(TARGET)

# –¶–µ–ª—å –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
.PHONY: all clean
